# Description: A library for reading and writing images, including classes, utilities, and applications.
# URL:         http://openimageio.org/
# Maintainer:  6c37 Team, https://github.com/6c37/crux-ports/issues
# Depends on:  cmake py3boost openjpeg libtiff libpng giflib ilmbase openexr
# Optional:    qt4 qt5 glew ffmpeg

name=openimageio
version=1.7.16
release=5
source=(
	https://github.com/OpenImageIO/oiio/archive/Release-$version.tar.gz
	oiio-boost-1.65-fix.patch
)

build() {
	cd oiio-Release-$version

	sed -i 's/1.42/1.53/g' src/python/CMakeLists.txt

	patch -p1 < $SRC/oiio-boost-1.65-fix.patch

	export PY3FLAGS=' -DUSE_PYTHON3=ON -DPYLIB3_INSTALL_DIR=lib/python3.6/site-packages'

	mkdir build && cd build
	cmake .. \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DUSE_OPENSSL=ON \
		$PY3FLAGS

	make
	make DESTDIR=$PKG install

	rm -rf $PKG/usr/share
}

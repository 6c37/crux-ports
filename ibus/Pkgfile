# Description: Intelligent Input Bus for Linux/unix.
# URL:         https://github.com/ibus/ibus/wiki
# Maintainer:  6c37 team, https://github.com/6c37/crux-ports/issues
# Depends on:  dbus-python libnotify iso-codes intltool

name=ibus
version=1.5.15
release=1
source=(https://github.com/$name/$name/releases/download/$version/$name-$version.tar.gz)

build() {
	cd $name-$version

	local VALA
	if [ "$(pkginfo -i | grep '^vala ' )" ]
	then
		VALA='--enable-vala=yes'
	else
		VALA='--enable-vala=no'
	fi

	local GTK3
	if [ "$(pkginfo -i | grep '^gtk3 ' )" ]
	then
		GTK3='--enable-gtk3'
	else
		GTK3='--disable-gtk3'
	fi

	local GCONF
	if [ "$(pkginfo -i | grep '^gconf ' )" ]
	then
		GCONF='--enable-gconf'
	else
		GCONF='--disable-gconf'
	fi

	local EMOJI
	if [ "$(pkginfo -i | grep '^json-glib ' )" ]
	then
		EMOJI='--enable-emoji-dict'
	else
		EMOJI='--disable-emoji-dict'
	fi

	./configure \
		--prefix=/usr \
		--sysconfdir=/etc \
		--libexecdir=/usr/lib/$name \
		--disable-nls \
		--disable-tests \
		$VALA \
		$GTK3 \
		--enable-xim \
		--enable-wayland=no \
		--disable-gtk-doc-html \
		$GCONF \
		--disable-dconf \
		--disable-appindicator \
		--with-python=python2 \
		--enable-python-library \
		$EMOJI

	# Workaround with --disable-emoji-dict
	make -C tools maintainer-clean-generic

	make
	make DESTDIR=$PKG install

	rm -rf $PKG/usr/share/gtk-doc
}
